var c=Object.defineProperty;var l=(o,i)=>c(o,"name",{value:i,configurable:!0});function h({getPaginatedOptionsUsing:o,perPage:i}){return{offset:0,hasMore:!0,isLoadingMore:!1,currentSearch:null,init(){this.$nextTick(()=>{this.attachScrollListener(),this.attachSearchListener()})},attachScrollListener(){let t=this.$el;new MutationObserver(()=>{let e=t.querySelector(".fi-dropdown-panel");e&&!e.hasAttribute("data-scroll-attached")&&(e.setAttribute("data-scroll-attached","true"),e.addEventListener("scroll",()=>this.handleScroll(e)),this.offset===0&&this.hasMore&&this.loadMoreOptions())}).observe(t,{childList:!0,subtree:!0})},attachSearchListener(){let t=this.$el;new MutationObserver(()=>{let e=t.querySelector(".fi-select-input-search-ctn input");e&&!e.hasAttribute("data-search-attached")&&(e.setAttribute("data-search-attached","true"),e.addEventListener("input",r=>{this.currentSearch=r.target.value,this.offset=0,this.hasMore=!0}))}).observe(t,{childList:!0,subtree:!0})},handleScroll(t){if(this.isLoadingMore||!this.hasMore)return;t.scrollHeight-t.scrollTop-t.clientHeight<50&&this.loadMoreOptions()},async loadMoreOptions(){if(!(this.isLoadingMore||!this.hasMore)){this.isLoadingMore=!0;try{let t=await o(this.offset,this.currentSearch),s=t.options??[];this.hasMore=t.hasMore??!1,this.appendOptionsToDropdown(s),this.offset+=i}catch(t){console.error("Failed to load options:",t)}finally{this.isLoadingMore=!1}}},appendOptionsToDropdown(t){let s=this.$el.querySelector(".fi-dropdown-panel ul");s&&t.forEach(e=>{let r=document.createElement("li");r.className="fi-dropdown-list-item fi-select-input-option",r.setAttribute("role","option"),r.setAttribute("data-value",e.value),r.setAttribute("tabindex","0");let a=document.createElement("span");a.textContent=e.label,r.appendChild(a),r.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),this.$dispatch("select-option",{value:e.value,label:e.label})}),s.appendChild(r)})}}}l(h,"infiniteScrollSelect");export{h as default};
